<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Flappy Bird</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      background: #222;
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
    }

    .game-container {
      width: 70vw;
      height: 500px;
      position: relative;
      overflow: hidden;
      background: #70c5ce;
      max-width: 800px;
      min-width: 400px;
      border-radius: 10px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø®ØªÙ„ÙØ© */
    @media (max-width: 768px) {
      .game-container {
        width: 90vw;
        height: 400px;
        min-width: 300px;
      }
    }

    @media (max-width: 480px) {
      .game-container {
        width: 95vw;
        height: 350px;
        min-width: 280px;
      }
    }

    .sky {
      background: linear-gradient(to bottom, #87CEEB 0%, #98E4FF 100%);
      width: 100%;
      height: 420px;
      position: absolute;
      background-size: cover;
      background-repeat: no-repeat;
      transition: all 0.3s ease;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø³Ù…Ø§Ø¡ */
    @media (max-width: 768px) {
      .sky {
        height: 320px;
      }
    }

    @media (max-width: 480px) {
      .sky {
        height: 270px;
      }
    }

    .bird {
      position: absolute;
      width: 40px;
      height: 40px;
      left: 150px;
      bottom: 250px;
      background: #FFD700;
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      border: 2px solid #FFA500;
      transition: all 0.1s ease;
      z-index: 10;
    }

    .bird::before {
      content: '';
      position: absolute;
      width: 8px;
      height: 8px;
      background: #FF4500;
      border-radius: 50%;
      top: 12px;
      left: 8px;
    }

    .bird::after {
      content: '';
      position: absolute;
      width: 15px;
      height: 20px;
      background: #FFD700;
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      top: 5px;
      left: 25px;
      transform: rotate(-20deg);
    }

    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø·Ø§Ø¦Ø± */
    @media (max-width: 480px) {
      .bird {
        width: 35px;
        height: 35px;
      }
    }

    .obstacle, .topObstacle {
      width: 70px !important;
      min-width: 70px !important;
      max-width: 70px !important;
      height: auto;
      position: absolute;
      background: #228B22;
      border: 3px solid #006400;
      border-radius: 8px;
      box-sizing: border-box !important;
      padding: 0 !important;
      margin: 0 !important;
    }

    .topObstacle {
      transform: rotate(180deg);
    }

    .ground {
      width: 100%;
      height: 80px;
      position: absolute;
      top: auto;
      bottom: 0;
      z-index: 2;
      background: #8B4513;
      border-top: 3px solid #654321;
    }

    .ground::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 20px;
      background: #32CD32;
      top: 0;
      left: 0;
    }

    .ground.moving {
      width: 200%;
      animation: slideright 2s infinite linear;
    }

    @keyframes slideright {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    .ground-container {
      height: 80px;
      width: 100%;
      left: 0;
      position: absolute;
      bottom: 0;
    }

    .score-board {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 24px;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      z-index: 10;
      background: rgba(0,0,0,0.3);
      padding: 8px 16px;
      border-radius: 8px;
    }

    @media (max-width: 768px) {
      .score-board {
        font-size: 20px;
      }
    }

    @media (max-width: 480px) {
      .score-board {
        font-size: 18px;
        padding: 6px 12px;
      }
    }

    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 20;
    }

    .overlay div {
      color: white;
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
      text-align: center;
    }

    .overlay button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px 24px;
      margin: 8px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      min-height: 44px;
      min-width: 44px;
    }

    .overlay button:hover {
      background: #45a049;
      transform: translateY(-2px);
    }

    .overlay button:active {
      transform: translateY(0);
    }

    .best-score {
      color: #ffd700;
      font-size: 18px;
      margin-bottom: 15px;
    }

    .secondary-btn {
      background: #666 !important;
    }

    .secondary-btn:hover {
      background: #888 !important;
    }

    .settings-container {
      margin: 20px 0;
    }

    .setting-label {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 15px 0;
      color: white;
      font-size: 16px;
    }

    .slider {
      width: 100px;
      margin-left: 15px;
    }

    .checkbox {
      margin-left: 15px;
      transform: scale(1.2);
    }

    #restartGameBtn {
      width: 100% !important;
      height: 300px !important;
      font-size: 24px !important;
      padding: 20px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      flex-direction: column !important;
    }

    @media (max-width: 480px) {
      #restartGameBtn {
        height: 200px !important;
        font-size: 20px !important;
        padding: 15px !important;
      }
    }

    .score-effect {
      position: absolute;
      color: #ffd700;
      font-size: 24px;
      font-weight: bold;
      pointer-events: none;
      z-index: 15;
      animation: scorePop 0.6s ease-out forwards;
    }

    @keyframes scorePop {
      0% {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
      100% {
        opacity: 0;
        transform: scale(1.5) translateY(-30px);
      }
    }

    @keyframes wingFlap {
      0%, 100% { transform: scaleY(1); }
      50% { transform: scaleY(0.8); }
    }

    .bird {
      animation: wingFlap 0.3s ease-in-out infinite;
    }

    .bird.jumping {
      animation: wingFlap 0.2s ease-in-out infinite, jumpRotate 0.1s ease-in-out;
    }

    @keyframes jumpRotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(-15deg); }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="score-board" id="score">Score: 0</div>
    <div class="sky">
      <div class="bird"></div>
    </div>
    <div class="ground-container">
      <div class="ground"></div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
    <div class="overlay" id="startScreen" role="dialog" aria-labelledby="game-title">
      <div id="game-title">ğŸ¤ Flappy Bird</div>
      <div id="bestScore" class="best-score" aria-live="polite">Best Score: 0</div>
      <button id="startGameBtn" aria-describedby="game-title">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
      <button id="settingsBtn" class="secondary-btn" aria-describedby="game-title">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    </div>

    <!-- Ø´Ø§Ø´Ø© Game Over -->
    <div class="overlay" id="gameOverScreen" style="display:none;" role="dialog" aria-labelledby="final-score">
      <div id="finalScore" aria-live="assertive">Game Over ğŸ˜¢<br>Score: 0</div>
      <button id="restartGameBtn" aria-describedby="final-score">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨</button>
      <button id="mainMenuBtn" class="secondary-btn" aria-describedby="final-score">ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <div class="overlay" id="settingsScreen" style="display:none;" role="dialog" aria-labelledby="settings-title">
      <div id="settings-title">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
      <div class="settings-container">
        <label class="setting-label" for="difficultySlider">
          <input type="range" id="difficultySlider" min="1" max="3" value="2" class="slider" aria-label="Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©">
          Ø§Ù„ØµØ¹ÙˆØ¨Ø©: <span id="difficultyText" aria-live="polite">Ù…ØªÙˆØ³Ø·Ø©</span>
        </label>
        <label class="setting-label" for="soundToggle">
          <input type="checkbox" id="soundToggle" checked class="checkbox" aria-label="ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª">
          Ø§Ù„Ø£ØµÙˆØ§Øª
        </label>
        <label class="setting-label" for="effectsToggle">
          <input type="checkbox" id="effectsToggle" checked class="checkbox" aria-label="Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ©">
          Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ©
        </label>
      </div>
      <button id="saveSettingsBtn" aria-describedby="settings-title">ğŸ’¾ Ø­ÙØ¸</button>
      <button id="backBtn" class="secondary-btn" aria-describedby="settings-title">ğŸ”™ Ø±Ø¬ÙˆØ¹</button>
    </div>
  </div>

  <script>
    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    let bird, gameDisplay, ground, scoreBoard, startScreen, gameOverScreen, finalScore, settingsScreen, bestScoreDisplay
    let birdLeft, birdBottom, gravity, isGameOver, gap, score, gameTimerId, gameSpeed

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
    let gameSettings = {
      difficulty: 2, // 1: Ø³Ù‡Ù„ØŒ 2: Ù…ØªÙˆØ³Ø·ØŒ 3: ØµØ¹Ø¨
      soundEnabled: true,
      effectsEnabled: true
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ØµÙˆØ§Øª Ù…Ø¹ AudioContext ÙˆØ§Ø­Ø¯
    let gameSounds = {
      audioContext: null,
      init: function() {
        if (gameSettings.soundEnabled) {
          try {
            this.audioContext = new (window.AudioContext || window.webkitAudioContext)()
          } catch (error) {
            console.warn('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ØµÙˆØ§Øª:', error)
          }
        }
      },
      createTone: function(frequency, duration, type) {
        if (!this.audioContext) return
        
        const oscillator = this.audioContext.createOscillator()
        const gainNode = this.audioContext.createGain()
        
        oscillator.connect(gainNode)
        gainNode.connect(this.audioContext.destination)
        
        oscillator.frequency.value = frequency
        oscillator.type = type
        gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime)
        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration)
        
        oscillator.start(this.audioContext.currentTime)
        oscillator.stop(this.audioContext.currentTime + duration)
      },
      playJump: function() {
        if (gameSettings.soundEnabled && this.audioContext) {
          this.createTone(440, 0.1, 'sine')
        }
      },
      playHit: function() {
        if (gameSettings.soundEnabled && this.audioContext) {
          this.createTone(200, 0.3, 'sawtooth')
        }
      },
      playPoint: function() {
        if (gameSettings.soundEnabled && this.audioContext) {
          this.createTone(880, 0.15, 'square')
        }
      }
    }

    // Ù…ØµÙÙˆÙØ© Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
    let activeObstacles = []
    let generateObstacleTimeout = null

    // ØªÙ‡ÙŠØ¦Ø© Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
    function initGameVars() {
      birdLeft = 150
      birdBottom = 250
      gravity = 0.6
      isGameOver = false
      score = 0
      gameSpeed = 2
      gap = 120
      gameTimerId = null
      activeObstacles = []
      
      // ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµØ¹ÙˆØ¨Ø©
      switch(gameSettings.difficulty) {
        case 1: // Ø³Ù‡Ù„
          gap = 150
          gameSpeed = 1.5
          break
        case 2: // Ù…ØªÙˆØ³Ø·
          gap = 120
          gameSpeed = 2
          break
        case 3: // ØµØ¹Ø¨
          gap = 100
          gameSpeed = 2.5
          break
      }
    }

    // ØªÙ‡ÙŠØ¦Ø© DOM
    document.addEventListener('DOMContentLoaded', function() {
      bird = document.querySelector('.bird')
      gameDisplay = document.querySelector('.game-container')
      ground = document.querySelector('.ground')
      scoreBoard = document.querySelector('#score')
      startScreen = document.querySelector('#startScreen')
      gameOverScreen = document.querySelector('#gameOverScreen')
      finalScore = document.querySelector('#finalScore')
      settingsScreen = document.querySelector('#settingsScreen')
      bestScoreDisplay = document.querySelector('#bestScore')
      
      if (bird) {
        bird.style.left = birdLeft + 'px'
        bird.style.bottom = birdBottom + 'px'
      }
      
      // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ØµÙˆØ§Øª
      gameSounds.init()
      
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
      loadSettings()
      
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
      setupButtonListeners()
      
      // ØªÙ‡ÙŠØ¦Ø© Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
      initGameVars()
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©
      updateBestScoreDisplay()
    })

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    function setupButtonListeners() {
      // ØªÙ†Ø¸ÙŠÙ Event Listeners Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
      removeAllEventListeners()
      
      // Ø²Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
      const startGameBtn = document.getElementById('startGameBtn')
      addEventListenerSafe(startGameBtn, 'click', startGame)
      
      // Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
      const settingsBtn = document.getElementById('settingsBtn')
      addEventListenerSafe(settingsBtn, 'click', toggleSettings)
      
      // Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨
      const restartGameBtn = document.getElementById('restartGameBtn')
      if (restartGameBtn) {
        addEventListenerSafe(restartGameBtn, 'click', restartGame)
      }
      
      // Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      const mainMenuBtn = document.getElementById('mainMenuBtn')
      if (mainMenuBtn) {
        addEventListenerSafe(mainMenuBtn, 'click', showMainMenu)
      }
      
      // Ø²Ø± Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
      const saveSettingsBtn = document.getElementById('saveSettingsBtn')
      addEventListenerSafe(saveSettingsBtn, 'click', saveSettings)
      
      // Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹
      const backBtn = document.getElementById('backBtn')
      addEventListenerSafe(backBtn, 'click', showMainMenu)
    }

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø­Ø¯Ø« Ø¢Ù…Ù†
    function addEventListenerSafe(element, event, handler) {
      if (element) {
        element.addEventListener(event, handler)
      }
    }

    // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    function removeAllEventListeners() {
      document.removeEventListener('keydown', control)
      document.removeEventListener('click', handleClick)
      document.removeEventListener('touchstart', handleTouch)
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
    function startGame() {
      if (!gameDisplay || !startScreen) return
      
      // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
      startScreen.style.display = 'none'
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
      gameDisplay.style.display = 'block'
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø­Ø±ÙƒØ© Ø§Ù„Ø£Ø±Ø¶
      if (ground) {
        ground.classList.add('moving')
      }
      
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
      document.addEventListener('keydown', control)
      document.addEventListener('click', handleClick)
      document.addEventListener('touchstart', handleTouch)
      
      // Ø¨Ø¯Ø¡ Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
      gameLoop()
      
      // Ø¨Ø¯Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª
      generateObstacle()
      
      // Ø¥Ø®ÙØ§Ø¡ ØªÙ„Ù…ÙŠØ­ Ø§Ù„ØªØ­ÙƒÙ…
      hideControlsHint()
    }

    // Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    function gameLoop() {
      if (isGameOver) return
      
      // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ©
      birdBottom -= gravity
      if (bird) {
        bird.style.bottom = birdBottom + 'px'
      }
      
      // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª
      moveObstacles()
      
      // ÙØ­Øµ Ø§Ù„ØªØµØ§Ø¯Ù…
      checkAllCollisions()
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØªÙŠØ¬Ø©
      updateScore()
      
      // Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ù„Ù‚Ø©
      gameTimerId = setTimeout(gameLoop, 20)
    }

    // ØªÙˆÙ„ÙŠØ¯ Ø¹Ù‚Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©
    function generateObstacle() {
      if (isGameOver || !gameDisplay) return
      
      const gameHeight = gameDisplay.offsetHeight
      const groundHeight = 80
      const minHeight = 50
      const maxHeight = gameHeight - groundHeight - gap - minHeight
      
      const obstacleHeight = Math.random() * (maxHeight - minHeight) + minHeight
      const topObstacleHeight = gameHeight - groundHeight - obstacleHeight - gap
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ©
      const obstacle = document.createElement('div')
      obstacle.className = 'obstacle'
      obstacle.style.left = gameDisplay.offsetWidth + 'px'
      obstacle.style.bottom = '0px'
      obstacle.style.height = obstacleHeight + 'px'
      obstacle.style.width = '70px'
      obstacle.style.minWidth = '70px'
      obstacle.style.maxWidth = '70px'
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ©
      const topObstacle = document.createElement('div')
      topObstacle.className = 'topObstacle'
      topObstacle.style.left = gameDisplay.offsetWidth + 'px'
      topObstacle.style.top = '0px'
      topObstacle.style.bottom = 'auto'
      topObstacle.style.height = topObstacleHeight + 'px'
      topObstacle.style.width = '70px'
      topObstacle.style.minWidth = '70px'
      topObstacle.style.maxWidth = '70px'
      
      gameDisplay.appendChild(obstacle)
      gameDisplay.appendChild(topObstacle)
      
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù†Ø´Ø·Ø©
      const obstacleData = {
        element: obstacle,
        topElement: topObstacle,
        left: gameDisplay.offsetWidth,
        bottomHeight: obstacleHeight,
        topHeight: topObstacleHeight,
        passed: false,
        timerId: null
      }
      
      activeObstacles.push(obstacleData)
      
      // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
      const nextDelay = Math.max(1500 - (score * 20), 800)
      generateObstacleTimeout = setTimeout(generateObstacle, nextDelay)
    }

    // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª
    function moveObstacles() {
      activeObstacles.forEach(obstacleData => {
        obstacleData.left -= gameSpeed
        
        if (obstacleData.element) {
          obstacleData.element.style.left = obstacleData.left + 'px'
        }
        if (obstacleData.topElement) {
          obstacleData.topElement.style.left = obstacleData.left + 'px'
        }
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ø§Ù„ØªÙŠ Ø®Ø±Ø¬Øª Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©
        if (obstacleData.left < -70) {
          if (obstacleData.element) obstacleData.element.remove()
          if (obstacleData.topElement) obstacleData.topElement.remove()
          
          // Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ©
          const index = activeObstacles.indexOf(obstacleData)
          if (index > -1) {
            activeObstacles.splice(index, 1)
          }
        }
      })
    }

    // ÙØ­Øµ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµØ§Ø¯Ù…Ø§Øª
    function checkAllCollisions() {
      if (!bird || !gameDisplay) return
      
      const birdRect = bird.getBoundingClientRect()
      const gameRect = gameDisplay.getBoundingClientRect()
      
      // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù†Ø³Ø¨ÙŠØ©
      const birdLeft = birdRect.left - gameRect.left
      const birdTop = birdRect.top - gameRect.top
      const birdRight = birdRect.right - gameRect.left
      const birdBottom = birdRect.bottom - gameRect.top
      
      // ÙØ­Øµ Ø§Ù„ØªØµØ§Ø¯Ù… Ù…Ø¹ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª
      activeObstacles.forEach(obstacleData => {
        if (!obstacleData.element || !obstacleData.topElement) return
        
        const obstacleRect = obstacleData.element.getBoundingClientRect()
        const topObstacleRect = obstacleData.topElement.getBoundingClientRect()
        
        // ØªØ­ÙˆÙŠÙ„ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª
        const obstacleLeft = obstacleRect.left - gameRect.left
        const obstacleRight = obstacleRect.right - gameRect.left
        const obstacleTop = obstacleRect.top - gameRect.top
        const obstacleBottom = obstacleRect.bottom - gameRect.top
        
        const topObstacleLeft = topObstacleRect.left - gameRect.left
        const topObstacleRight = topObstacleRect.right - gameRect.left
        const topObstacleTop = topObstacleRect.top - gameRect.top
        const topObstacleBottom = topObstacleRect.bottom - gameRect.top
        
        // ÙØ­Øµ Ø§Ù„ØªØµØ§Ø¯Ù… Ø§Ù„Ø£ÙÙ‚ÙŠ
        const horizontalOverlap = birdRight > obstacleLeft && birdLeft < obstacleRight
        
        if (horizontalOverlap) {
          // ÙØ­Øµ Ø§Ù„ØªØµØ§Ø¯Ù… Ù…Ø¹ Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ©
          if (birdBottom > obstacleTop) {
            gameOver()
            return
          }
          
          // ÙØ­Øµ Ø§Ù„ØªØµØ§Ø¯Ù… Ù…Ø¹ Ø§Ù„Ø¹Ù‚Ø¨Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ©
          if (birdTop < topObstacleBottom) {
            gameOver()
            return
          }
        }
      })
      
      // ÙØ­Øµ Ø§Ù„ØªØµØ§Ø¯Ù… Ù…Ø¹ Ø§Ù„Ø£Ø±Ø¶
      if (birdBottom <= 0) {
        gameOver()
      }
      
      // ÙØ­Øµ Ø§Ù„ØªØµØ§Ø¯Ù… Ù…Ø¹ Ø§Ù„Ø³Ù‚Ù
      if (birdTop <= 0) {
        gameOver()
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØªÙŠØ¬Ø©
    function updateScore() {
      activeObstacles.forEach(obstacleData => {
        if (!obstacleData.passed && obstacleData.left + 70 < birdLeft) {
          obstacleData.passed = true
          score++
          
          if (scoreBoard) {
            scoreBoard.textContent = 'Score: ' + score
          }
          
          // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ù†Ù‚Ø·Ø©
          gameSounds.playPoint()
          
          // Ø¥Ø¸Ù‡Ø§Ø± ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ù‚Ø·Ø©
          if (gameSettings.effectsEnabled) {
            showScoreEffect()
          }
          
          // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØµØ¹ÙˆØ¨Ø© ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹
          if (score % 15 === 0) {
            gameSpeed += 0.03
            if (gap > 100) gap -= 1
          }
        }
      })
    }

    // Ø¥Ø¸Ù‡Ø§Ø± ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ù‚Ø·Ø©
    let scoreEffectElement = null
    function showScoreEffect() {
      if (!gameDisplay) return
      
      // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
      if (!scoreEffectElement) {
        scoreEffectElement = document.createElement('div')
        scoreEffectElement.className = 'score-effect'
        gameDisplay.appendChild(scoreEffectElement)
      }
      
      scoreEffectElement.textContent = '+1'
      scoreEffectElement.style.left = '50%'
      scoreEffectElement.style.top = '30%'
      scoreEffectElement.style.transform = 'translateX(-50%)'
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
      scoreEffectElement.style.animation = 'none'
      scoreEffectElement.offsetHeight // Ø¥Ø¬Ø¨Ø§Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø±Ø³Ù…
      scoreEffectElement.style.animation = 'scorePop 0.6s ease-out forwards'
    }

    // Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø·Ø§Ø¦Ø±
    let lastJumpTime = 0
    const jumpCooldown = 100 // 100ms cooldown

    function jump() {
      const now = Date.now()
      if (now - lastJumpTime < jumpCooldown) return
      
      lastJumpTime = now
      
      if (isGameOver) return
      
      birdBottom += 50
      if (bird) {
        bird.style.bottom = birdBottom + 'px'
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚ÙØ²Ø©
        if (gameSettings.effectsEnabled) {
          bird.classList.add('jumping')
          setTimeout(() => {
            bird.classList.remove('jumping')
          }, 100)
        }
      }
      
      // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ù‚ÙØ²Ø©
      gameSounds.playJump()
      
      // Ø¥Ø®ÙØ§Ø¡ ØªÙ„Ù…ÙŠØ­ Ø§Ù„ØªØ­ÙƒÙ…
      hideControlsHint()
    }

    // Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    function control(e) {
      if (e.code === 'Space') {
        e.preventDefault()
        jump()
      }
    }

    function handleClick(e) {
      e.preventDefault()
      jump()
    }

    function handleTouch(e) {
      e.preventDefault()
      e.stopPropagation()
      jump()
    }

    // Ø¥Ø®ÙØ§Ø¡ ØªÙ„Ù…ÙŠØ­ Ø§Ù„ØªØ­ÙƒÙ…
    function hideControlsHint() {
      // Ø¥Ø®ÙØ§Ø¡ Ø£ÙŠ ØªÙ„Ù…ÙŠØ­ Ù…ÙˆØ¬ÙˆØ¯
    }

    // Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
    function gameOver() {
      if (isGameOver) return
      
      isGameOver = true
      
      // Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¤Ù‚ØªØ§Øª
      if (gameTimerId) {
        clearTimeout(gameTimerId)
        gameTimerId = null
      }
      
      if (generateObstacleTimeout) {
        clearTimeout(generateObstacleTimeout)
        generateObstacleTimeout = null
      }
      
      // Ø¥ÙŠÙ‚Ø§Ù Ø­Ø±ÙƒØ© Ø§Ù„Ø£Ø±Ø¶
      if (ground) {
        ground.classList.remove('moving')
      }
      
      // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù…
      gameSounds.playHit()
      
      // ØªØ­Ø¯ÙŠØ« Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©
      updateBestScore()
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Game Over
      if (gameOverScreen && finalScore) {
        const isNewRecord = score > getBestScore()
        finalScore.innerHTML = `
          <div style="font-size: 28px; margin-bottom: 15px;">Game Over ğŸ˜¢</div>
          <div style="font-size: 24px; margin-bottom: 10px;">Score: ${score}</div>
          ${isNewRecord ? '<div style="color: #ffd700; font-size: 20px;">ğŸ‰ New Record!</div>' : ''}
        `
        gameOverScreen.style.display = 'flex'
      }
      
      // Ø¥Ø²Ø§Ù„Ø© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
      removeAllEventListeners()
    }

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©
    function restartGame() {
      // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
      if (!gameDisplay || !gameOverScreen) {
        return
      }
      
      // Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¤Ù‚ØªØ§Øª
      if (gameTimerId) {
        clearTimeout(gameTimerId)
        gameTimerId = null
      }
      
      // Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ù…Ø¤Ù‚ØªØ§Øª Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
      activeObstacles.forEach(obstacle => {
        if (obstacle.timerId) {
          clearTimeout(obstacle.timerId)
        }
      })
      
      // Ø¥Ù„ØºØ§Ø¡ setTimeout Ù„ØªØ¬Ù†Ø¨ ØªØ³Ø±ÙŠØ¨Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø©
      if (generateObstacleTimeout) {
        clearTimeout(generateObstacleTimeout)
        generateObstacleTimeout = null
      }
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¤Ù‚ØªØ§Øª
      gameTimerId = null
      
      // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù‚Ø¨Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
      document.removeEventListener('keydown', control)
      document.removeEventListener('click', handleClick)
      document.removeEventListener('touchstart', handleTouch)
      
      // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
      const obstacles = document.querySelectorAll('.obstacle, .topObstacle')
      obstacles.forEach(obstacle => obstacle.remove())
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù…ØµÙÙˆÙØ© Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
      activeObstacles = []
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
      isGameOver = false
      score = 0
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø·Ø§Ø¦Ø± ÙˆØ§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¨ØµØ±ÙŠØ©
      if (bird) {
        birdLeft = 150
        birdBottom = 250
        bird.style.left = birdLeft + 'px'
        bird.style.bottom = birdBottom + 'px'
        
        // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ©
        if (gameSettings.effectsEnabled) {
          bird.classList.remove('jumping', 'falling')
        }
      }
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†ØªÙŠØ¬Ø©
      if (scoreBoard) {
        scoreBoard.textContent = 'Score: 0'
      }
      
      // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Game Over
      if (gameOverScreen) {
        gameOverScreen.style.display = 'none'
      }
      
      // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø­Ø±ÙƒØ© Ø§Ù„Ø£Ø±Ø¶
      if (ground) {
        ground.classList.add('moving')
      }
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©
      startGame()
    }

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    function showMainMenu() {
      // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØªØ¹Ù…Ù„
      if (gameTimerId) {
        clearTimeout(gameTimerId)
        gameTimerId = null
      }
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
      isGameOver = false
      
      // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª
      if (gameOverScreen) {
        gameOverScreen.style.display = 'none'
      }
      if (settingsScreen) {
        settingsScreen.style.display = 'none'
      }
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
      if (startScreen) {
        startScreen.style.display = 'flex'
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©
      updateBestScoreDisplay()
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
      initGameVars()
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    function toggleSettings() {
      if (startScreen) startScreen.style.display = 'none'
      if (settingsScreen) settingsScreen.style.display = 'flex'
      
      // ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
      updateSettingsDisplay()
    }

    // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    function updateSettingsDisplay() {
      const difficultySlider = document.getElementById('difficultySlider')
      const difficultyText = document.getElementById('difficultyText')
      const soundToggle = document.getElementById('soundToggle')
      const effectsToggle = document.getElementById('effectsToggle')
      
      if (difficultySlider) difficultySlider.value = gameSettings.difficulty
      if (soundToggle) soundToggle.checked = gameSettings.soundEnabled
      if (effectsToggle) effectsToggle.checked = gameSettings.effectsEnabled
      
      if (difficultyText) {
        const difficultyNames = ['', 'Ø³Ù‡Ù„', 'Ù…ØªÙˆØ³Ø·', 'ØµØ¹Ø¨']
        difficultyText.textContent = difficultyNames[gameSettings.difficulty]
      }
    }

    // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    function saveSettings() {
      const difficultySlider = document.getElementById('difficultySlider')
      const soundToggle = document.getElementById('soundToggle')
      const effectsToggle = document.getElementById('effectsToggle')
      
      if (difficultySlider) gameSettings.difficulty = parseInt(difficultySlider.value)
      if (soundToggle) gameSettings.soundEnabled = soundToggle.checked
      if (effectsToggle) gameSettings.effectsEnabled = effectsToggle.checked
      
      // Ø­ÙØ¸ ÙÙŠ localStorage
      try {
        localStorage.setItem('flappyBirdSettings', JSON.stringify(gameSettings))
      } catch (error) {
        console.warn('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', error)
      }
      
      // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      showMainMenu()
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    function loadSettings() {
      try {
        const savedSettings = localStorage.getItem('flappyBirdSettings')
        if (savedSettings) {
          const parsed = JSON.parse(savedSettings)
          gameSettings = { ...gameSettings, ...parsed }
        }
      } catch (error) {
        console.warn('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', error)
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©
    function updateBestScore() {
      const currentBest = getBestScore()
      if (score > currentBest) {
        try {
          localStorage.setItem('flappyBirdBestScore', score.toString())
          updateBestScoreDisplay()
        } catch (error) {
          console.warn('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­ÙØ¸ Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©:', error)
        }
      }
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©
    function getBestScore() {
      try {
        const best = localStorage.getItem('flappyBirdBestScore')
        return best ? parseInt(best) : 0
      } catch (error) {
        console.warn('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù‚Ø±Ø§Ø¡Ø© Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©:', error)
        return 0
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©
    function updateBestScoreDisplay() {
      if (bestScoreDisplay) {
        const best = getBestScore()
        bestScoreDisplay.textContent = 'Best Score: ' + best
      }
    }
  </script>
</body>
</html>
